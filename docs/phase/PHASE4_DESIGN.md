# Phase 4: μ—­μ „ ν¬μΈνΈ νƒμƒ‰ (10KB ~ 1MB)

## λ©μ 

Phase 1~2μ—μ„ ν™•μΈλ κ²°κ³Ό:
- **10KB**: gRPCκ°€ 43% λ” λΉ λ¦„
- **1MB**: HTTPκ°€ 2λ°° λ” λΉ λ¦„

μ΄ μ‚¬μ΄ μ–΄λ”κ°€μ— **gRPCμ™€ HTTPμ μ„±λ¥μ΄ μ—­μ „λλ” μ§€μ **μ΄ μ΅΄μ¬ν•λ‹¤.  
μ •ν™•ν• μ—­μ „ ν¬μΈνΈλ¥Ό μ°Ύλ”λ‹¤.

## κ°€μ„¤

> "νμ΄λ΅λ“ ν¬κΈ°κ°€ μ»¤μ§μλ΅ Protobuf μ§λ ¬ν™” μ¤λ²„ν—¤λ“κ°€ μ¦κ°€ν•μ—¬  
> 100KB ~ 500KB μ‚¬μ΄μ—μ„ HTTPκ°€ gRPCλ¥Ό μ¶”μ›”ν•  κ²ƒμ΄λ‹¤"

## λ°°κ²½

### μ™ μ—­μ „μ΄ λ°μƒν•λ”κ°€?

**gRPC μ¤λ²„ν—¤λ“ μ”μ†:**
- Protobuf μ§λ ¬ν™”: `ByteString.copyFrom(payload)` - O(n) λ³µμ‚¬
- HTTP/2 ν”„λ μ΄λ°: κ° DATA ν”„λ μ„λ§λ‹¤ 9λ°”μ΄νΈ ν—¤λ”
- 1MB = 62κ° ν”„λ μ„ Γ— 9B = 558B μ¶”κ°€ μ¤λ²„ν—¤λ“

**HTTP μ¤λ²„ν—¤λ“ μ”μ†:**
- ν…μ¤νΈ ν—¤λ”: ~400B (κ³ μ •)
- JSONμ κ²½μ° Base64: 33% ν¬κΈ° μ¦κ°€

**νμ΄λ΅λ“ ν¬κΈ°λ³„ μ¤λ²„ν—¤λ“ λΉ„μ¨:**

| ν¬κΈ° | HTTP ν—¤λ” λΉ„μ¨ | gRPC μ§λ ¬ν™” μν–¥ |
|-----|---------------|-----------------|
| 10KB | 4% | λ‚®μ |
| 50KB | 0.8% | μ¤‘κ°„ |
| 100KB | 0.4% | λ†’μ |
| 500KB | 0.08% | λ§¤μ° λ†’μ |
| 1MB | 0.04% | μ§€λ°°μ  |

## ν…μ¤νΈ λ§¤νΈλ¦­μ¤

| ν¬κΈ° | HTTP/Binary | gRPC/Unary | μμƒ μΉμ |
|-----|-------------|------------|----------|
| 10KB | β… | β… | gRPC |
| 50KB | β… | β… | ? |
| 100KB | β… | β… | ? (μ—­μ „ μμƒ) |
| 200KB | β… | β… | HTTP |
| 500KB | β… | β… | HTTP |

## ν…μ¤νΈ μ΅°κ±΄

| ν•­λ© | κ°’ |
|------|-----|
| νμ΄λ΅λ“ ν¬κΈ° | 10KB β†’ 50KB β†’ 100KB β†’ 200KB β†’ 500KB |
| λ™μ‹ μ‚¬μ©μ (VU) | 10 |
| ν…μ¤νΈ μ‹κ°„ | κ° 30μ΄ |
| ν…μ¤νΈ λ€μƒ | HTTP/JSON, HTTP/Binary, gRPC/Unary, gRPC/Stream |

## μ½”λ“ μμ • ν•„μ”

### DataService.kt
```kotlin
companion object {
    val PAYLOAD_SIZES = mapOf(
        "1kb" to 1 * 1024,
        "10kb" to 10 * 1024,
        "50kb" to 50 * 1024,      // μ¶”κ°€
        "100kb" to 100 * 1024,
        "200kb" to 200 * 1024,    // μ¶”κ°€
        "500kb" to 500 * 1024,    // μ¶”κ°€
        "1mb" to 1 * 1024 * 1024
    )
}
```

## μ‹¤ν–‰ λ°©λ²•

```bash
cd scripts

# μ „μ²΄ μ‹¤ν–‰
./run-phase4.sh

# κ°λ³„ ν¬κΈ° ν…μ¤νΈ
SIZE_LIST="50kb 100kb" ./run-phase4.sh

# κ°λ³„ μ¤ν¬λ¦½νΈ μ‹¤ν–‰
k6 run -e SIZE=100kb phase4/http-json-test.js
k6 run -e SIZE=100kb phase4/http-binary-test.js
k6 run -e SIZE=100kb phase4/grpc-test.js
k6 run -e SIZE=100kb phase4/grpc-stream-test.js
```

## μμƒ κ²°κ³Ό κ·Έλν”„

```
Throughput (req/s)
     ^
     |     gRPC
     |    /
     |   /     HTTP
     |  /     /
     | /     /
     |/     /
     Xβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€> νμ΄λ΅λ“ ν¬κΈ°
     10KB  50KB  100KB  200KB  500KB  1MB
           
           β†‘
        μ—­μ „ ν¬μΈνΈ
```

## μƒνƒ

π“‹ **μμ •**